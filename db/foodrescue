-- database.sql
-- Buat database baru
CREATE DATABASE IF NOT EXISTS foodrescue CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- Gunakan database
USE foodrescue;

-- Tabel untuk menyimpan saran/pesan dari pengguna
CREATE TABLE saran (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nama VARCHAR(100) NOT NULL,
    email VARCHAR(150) NOT NULL,
    pesan TEXT NOT NULL,
    tanggal_kirim DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    status ENUM('baru', 'dibaca', 'dibalas') DEFAULT 'baru',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Tabel untuk admin (opsional, untuk sistem login admin yang lebih aman)
CREATE TABLE admin (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    nama VARCHAR(100) NOT NULL,
    email VARCHAR(150) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Tabel untuk Penyumbang
CREATE TABLE penyumbang (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nama VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL UNIQUE,
    no_hp VARCHAR(20) NOT NULL,
    password VARCHAR(255) NOT NULL,
    alamat TEXT,
    status ENUM('active', 'inactive') DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Tabel untuk Penerima
CREATE TABLE penerima (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nama VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL UNIQUE,
    no_hp VARCHAR(20) NOT NULL,
    password VARCHAR(255) NOT NULL,
    alamat TEXT,
    status ENUM('active', 'inactive') DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Tabel untuk Donasi Makanan
CREATE TABLE donasi (
    id INT AUTO_INCREMENT PRIMARY KEY,
    penyumbang_id INT NOT NULL,
    nama_makanan VARCHAR(255) NOT NULL,
    deskripsi TEXT,
    jumlah VARCHAR(100),
    expired_date DATE,
    lokasi_pickup TEXT,
    foto VARCHAR(255),
    status ENUM('tersedia', 'diambil', 'expired') DEFAULT 'tersedia',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (penyumbang_id) REFERENCES penyumbang(id) ON DELETE CASCADE
);

-- Tabel untuk Request Makanan
CREATE TABLE requests (
    id INT AUTO_INCREMENT PRIMARY KEY,
    penerima_id INT NOT NULL,
    donasi_id INT NOT NULL,
    pesan TEXT,
    status ENUM('pending', 'approved', 'rejected', 'completed') DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (penerima_id) REFERENCES penerima(id) ON DELETE CASCADE,
    FOREIGN KEY (donasi_id) REFERENCES donasi(id) ON DELETE CASCADE
);

-- Insert admin default (password: admin123)
INSERT INTO admin (username, password, nama, email) VALUES 
('admin', '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'Administrator', 'admin@foodsharing.com');

-- Tambahkan beberapa data contoh saran
INSERT INTO saran (nama, email, pesan, status) VALUES 
('John Doe', 'john@example.com', 'Website ini sangat bagus dan informatif. Terima kasih sudah membuat platform untuk mengurangi food waste!', 'dibaca'),
('Sarah Wilson', 'sarah@example.com', 'Saya suka sekali dengan inisiatif ini. Bagaimana cara untuk bergabung sebagai volunteer?', 'baru'),
('Ahmad Rizki', 'ahmad@example.com', 'Apakah ada rencana untuk membuat aplikasi mobile? Akan sangat membantu untuk berbagi makanan dengan lebih mudah.', 'baru'),
('Maria Santos', 'maria@example.com', 'Data statistik yang ditampilkan sangat mengejutkan. Saya ingin berkontribusi lebih dalam program ini.', 'dibaca');

-- Index untuk optimasi query
CREATE INDEX idx_saran_tanggal ON saran(tanggal_kirim);
CREATE INDEX idx_saran_status ON saran(status);
CREATE INDEX idx_saran_email ON saran(email);